import { CatalogDialog } from "catalog_dialog.slint";
import { ImportPhotosScreen } from "ImportPhotosScreen.slint";
import { Button, Slider } from "std-widgets.slint";
export { CatalogDialog, ImportPhotosScreen }

export component MainWindow inherits Window {
    width: 1400px;
    height: 800px;
    title: "ZenithPhoto";

    in-out property <image> preview_image;
    in-out property <string> current-path;
    in-out property <[string]> recent-catalogs;
    in-out property <string> status-text;

    callback open-image-request();
    callback new-catalog-requested();
    callback open-catalog-requested();
    callback open-recent-catalog-requested(path: string);
    callback clear-recent-catalogs-requested();
    callback import-photos-requested();
    callback exit-requested();

    forward-focus: shortcuts;

    menu := MenuBar {
        Menu {
            title: "File";

            MenuItem {
                title: "New Catalog...";
                activated => root.new-catalog-requested();
            }

            MenuItem {
                title: "Open Catalog...";
                activated => root.open-catalog-requested();
            }

            Menu {
                title: "Recent Catalogs";

                if root.recent-catalogs.length == 0: MenuItem {
                    title: "No Recent Catalogs";
                    enabled: false;
                }

                for entry in root.recent-catalogs: MenuItem {
                    title: entry;
                    activated => {
                        root.open-recent-catalog-requested(entry);
                    }
                }

                MenuSeparator { }

                MenuItem {
                    title: "Clear Recent Catalogs";
                    activated => root.clear-recent-catalogs-requested();
                }
            }

            MenuItem {
                title: "Import Photosâ€¦";
                activated => root.import-photos-requested();
            }

            MenuItem {
                title: "Exit";
                activated => root.exit-requested();
            }
        }
    }

    shortcuts := FocusScope {
        width: parent.width;
        height: parent.height;

        key_pressed(event) => {
            if (event.modifiers.control && (event.text == "o" || event.text == "O")) {
                root.open-catalog-requested();
                return accept;
            }

            if (event.modifiers.control && (event.text == "q" || event.text == "Q")) {
                root.exit-requested();
                return accept;
            }

            if ((event.modifiers.control || event.modifiers.meta) && (event.text == "i" || event.text == "I")) {
                root.import-photos-requested();
                return accept;
            }

            return reject;
        }

        // Basic layout: left panel (stub), center preview, right controls
        HorizontalLayout {
            spacing: 8px;
            padding: 8px;

            // Left panel (future: folders, collections)
            VerticalLayout {
                width: 260px;
                spacing: 8px;

                Text {
                    text: "Library";
                    font-weight: 600;
                }

                Button {
                    text: "Open Image...";
                    clicked => {
                        root.open-image-request();
                    }
                }

                Text {
                    text: root.current-path;
                    wrap: word-wrap;
                    font-size: 10px;
                    color: #bbbbbb;
                }
                if root.status-text != "": Text {
                    text: root.status-text;
                    wrap: word-wrap;
                    font-size: 10px;
                    color: #8fb3ff;
                }
            }

            // Center: preview
            Rectangle {
                horizontal-stretch: 1;
                vertical-stretch: 1;
                background: #202020;

                Image {
                    source: root.preview_image;
                    width: parent.width;
                    height: parent.height;
                    image-fit: contain;
                }
            }

            // Right: basic develop sliders (just stubbed; wired later)
            VerticalLayout {
                width: 260px;
                spacing: 12px;

                Text {
                    text: "Develop";
                    font-weight: 600;
                }

                Text { text: "Exposure"; }
                Slider {
                    minimum: -5;
                    maximum: 5;
                    value: 0;
                }

                Text { text: "Contrast"; }
                Slider {
                    minimum: -100;
                    maximum: 100;
                    value: 0;
                }

                Text { text: "Highlights"; }
                Slider {
                    minimum: -100;
                    maximum: 100;
                    value: 0;
                }

                Text { text: "Shadows"; }
                Slider {
                    minimum: -100;
                    maximum: 100;
                    value: 0;
                }
            }
        }
    }
}
